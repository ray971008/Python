%%{init: {"theme":"base"}}%%
flowchart TD
    A[開始] --> B[讀取縣市鄉鎮區代碼 CSV 與商圈 CSV]
    B --> C[初始化空 list 儲存縣市、鄉鎮區及代碼]
    C --> D[對每個商圈地址進行迴圈]
    
    D --> E{地址以「縣」結尾?}
    E -->|是| F[使用正則匹配「縣 + 鄉鎮市」]
    E -->|否| G{地址以「市」結尾?}
    G -->|是| H[使用正則匹配「市 + 區」]
    G -->|否| I[無法匹配，列印提示訊息]
    
    F --> J[取得縣市名稱與鄉鎮區名稱]
    H --> J
    I --> J
    
    J --> K[查詢縣市代碼並加入 list]
    K --> L[查詢鄉鎮區代碼並加入 list]
    L --> M{是否所有地址都處理完?}
    M -->|否| D
    M -->|是| N[將 list 資料加入 df2]
    
    N --> O[整理欄位順序]
    O --> P[輸出完整商圈 CSV]
    P --> Q[結束]
